<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Livros cadastrados</title>
  <link rel="stylesheet" href="css/livrosCadastrados.css">
</head>

<body>

  <img src="assets/icon/seta sair.png" class="sairLogin" onclick="sair()">
  <div id="tituloLivros">
    <h1>Mangás cadastrados</h1>
  </div>
  <div id="prateleira"></div>


  <div id="maisCadastros">
    <button onclick="cadastroLivro()">Cadastre Mangá</button>
  </div>
</body>

</html>

<script>
  var idUsuario = sessionStorage.ID_USUARIO;

  function sair() {

    window.location = "index.html";
  }
    function editarLivro(idManga) {
        sessionStorage.ID_MANGA_EDITANDO = idManga;
        window.alert("Você será redirecionado à página de edição do mangá de id número: " + idManga);
        window.location = "/editLivro.html"
    }

  function excluirLivro(idManga) {
    console.log("Criar função de apagar post escolhido - ID" + idManga);
    fetch(`/avisos/deletarLivro/${idManga}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json"
      }
    }).then(function (resposta) {

      if (resposta.ok) {
        window.alert("Livro deletado com sucesso pelo! usuário: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
        window.location = "/livrosCadastrados.html"
      } else if (resposta.status == 404) {
        window.alert("Deu 404!");
      } else {
        throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
    });
  }

  function pagManga(idManga) {
    sessionStorage.ID_PAGINA_MANGA = idManga;

    console.log("cliquei na pagina  - " + idManga);
    console.log("Você será redirecionado à página de edição do aviso de id número: " + idManga);
    window.location = "/pagManga.html"

  }

  fetch(`avisos/postados/${sessionStorage.getItem("ID_USUARIO")}`).then(function (resposta) {
    if (resposta.ok) {

      if (resposta.status == 204) {
        alert("Nenhum resultado encontrado.");
      }

      resposta.json().then(function (resposta) {
        console.log("Dados recebidos: ", JSON.stringify(resposta));
        console.log(resposta);

        for (var i = 0; i < resposta.length; i++) {
          var pesquisa = resposta[i];

          prateleira.innerHTML += `<a id="container" > 
                                    <img src="${pesquisa.linkImagem}"  onclick="pagManga(${pesquisa.idManga})" id="imgLivro"  alt="">
                                    <div id="botoes">
                                    <button onclick="excluirLivro(${pesquisa.idManga})">excluir</button>
         
                                    <button onclick="editarLivro(${pesquisa.idManga})">editar</button>
                                    </div>
                                    </a>
                                  `
        }


      });
    } else {
      throw ('Houve um erro na API!');
    }
  }).catch(function (resposta) {
    console.error(resposta);
  });

  function cadastroLivro(){
    window.location = "cadastroLivro.html"
  }


</script>